<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EchoVerse Player — Sacred Certainty</title>
  <style>
    :root{
      --bg0:#07090c;
      --bg1:#0b1016;
      --card:rgba(255,255,255,.04);
      --card2:rgba(0,0,0,.25);
      --edge:rgba(255,255,255,.12);
      --edge2:rgba(255,255,255,.07);
      --fg:#e7eef7;
      --muted:#9aa7b6;
      --warm:rgba(255,160,64,.92);
      --warm2:rgba(255,160,64,.35);
      --good:rgba(120,255,180,.85);
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --r:18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.06), transparent 55%),
        radial-gradient(900px 500px at 85% 30%, rgba(255,160,64,.08), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    .wrap{
      height:100%;
      display:grid;
      grid-template-rows:auto 1fr auto;
      gap:12px;
      padding:18px;
    }

    .top{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      padding:14px 14px 10px;
      border:1px solid var(--edge);
      border-radius:var(--r);
      background:var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .title h1{
      margin:0;
      font-size:18px;
      letter-spacing:.14em;
      text-transform:uppercase;
    }
    .title p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
      max-width:62ch;
    }
    .meta{
      text-align:right;
      font-size:12px;
      color:var(--muted);
      line-height:1.55;
      white-space:nowrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--edge2);
      border-radius:999px;
      background:rgba(0,0,0,.18);
      color:var(--fg);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .pill i{
      width:8px;height:8px;border-radius:50%;
      background:var(--warm);
      box-shadow: 0 0 18px var(--warm);
      display:inline-block;
    }

    /* Main */
    .main{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:12px;
      min-height:0;
    }

    .panel{
      border:1px solid var(--edge);
      border-radius:var(--r);
      background:var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      min-height:0;
    }

    /* Left: Cover + Player */
    .left{
      display:grid;
      grid-template-rows:auto auto 1fr;
      min-height:0;
    }
    .cover{
      position:relative;
      aspect-ratio: 1 / 1;
      width:100%;
      overflow:hidden;
      border-bottom:1px solid var(--edge2);
      background:rgba(0,0,0,.35);
    }
    .cover img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter: saturate(1.05) contrast(1.05);
      transform: scale(1.01);
    }
    .cover::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(600px 300px at 30% 10%, rgba(255,255,255,.10), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.45));
      pointer-events:none;
    }
    .coverLabel{
      position:absolute;
      left:12px;
      bottom:12px;
      right:12px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      pointer-events:none;
    }
    .coverLabel .track{
      display:flex;
      flex-direction:column;
      gap:4px;
      text-shadow: 0 8px 24px rgba(0,0,0,.7);
    }
    .coverLabel .track strong{
      font-size:14px;
      letter-spacing:.10em;
      text-transform:uppercase;
    }
    .coverLabel .track span{
      font-size:12px;
      color:rgba(231,238,247,.85);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.35);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      font-size:12px;
      color:rgba(231,238,247,.92);
    }
    .badge b{
      width:8px;height:8px;border-radius:50%;
      background:var(--warm);
      box-shadow: 0 0 16px var(--warm);
      display:inline-block;
    }

    .player{
      padding:14px;
      border-bottom:1px solid var(--edge2);
      background:linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.22));
    }
.player{
  position: sticky;
  bottom: 0;
  z-index: 10;
  background: linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.82));
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255,255,255,.08);
}
    
    .controlsRow{
      display:flex;
      gap:10px;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.35);
      color:var(--fg);
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .btn:hover{
      background:rgba(255,255,255,.06);
      border-color:rgba(255,255,255,.20);
    }
    .btn:active{ transform: translateY(1px); }

    .btnPrimary{
      border-color: rgba(255,160,64,.35);
      background: rgba(255,160,64,.10);
    }
    .btnPrimary:hover{
      background: rgba(255,160,64,.14);
      border-color: rgba(255,160,64,.55);
    }

    .btnIcon{
      width:44px;
      height:44px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:16px;
      font-size:16px;
      line-height:1;
    }

    .time{
      font-variant-numeric: tabular-nums;
      color:rgba(231,238,247,.9);
      font-size:12px;
      min-width:86px;
      text-align:right;
    }

    .bar{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-width:0;
    }

    input[type="range"]{
      width:100%;
      accent-color: #ffffff;
    }
    .seek{
      height:22px;
    }
    .subRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color:var(--muted);
      font-size:12px;
    }
    .subRow .leftMeta{
      display:flex;
      gap:10px;
      align-items:center;
      min-width:0;
    }
    .subRow .rightMeta{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      white-space:nowrap;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      color:rgba(231,238,247,.88);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .chip small{ color:rgba(231,238,247,.75); }

    .sliders{
      display:flex;
      gap:10px;
      margin-top:10px;
      align-items:center;
    }
    .sliderGroup{
      flex:1;
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      min-width:0;
    }
    .sliderGroup label{
      font-size:12px;
      color:rgba(231,238,247,.78);
      white-space:nowrap;
    }
    .sliderGroup input{ flex:1; min-width:0; }
    .sliderGroup .val{
      width:44px;
      text-align:right;
      font-variant-numeric: tabular-nums;
      font-size:12px;
      color:rgba(231,238,247,.9);
    }

    /* Lyrics */
    .lyrics{
      padding:14px;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .lyricsTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .lyricsTop h2{
      margin:0;
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(231,238,247,.92);
    }
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color:rgba(231,238,247,.82);
      cursor:pointer;
      user-select:none;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.20);
    }
    .toggle:hover{ background:rgba(255,255,255,.05); }

    .lyricsBox{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.20);
      border-radius:16px;
      padding:12px;
      overflow:auto;
      min-height:0;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }

    .sec{
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.02);
      margin-bottom:10px;
    }
    .secHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
    }
    .secHeader b{
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:12px;
    }
    .secHeader span{
      color:rgba(231,238,247,.65);
      font-size:12px;
    }
    .sec p{
      margin:0;
      color:rgba(231,238,247,.88);
      font-size:13px;
      line-height:1.55;
      white-space:pre-wrap;
    }
    .sec em{
      color:rgba(255,160,64,.90);
      font-style:normal;
    }

    /* Right: Visualizer */
    .right{
      position:relative;
      min-height:0;
    }
    .canvasCard{
      position:relative;
      width:100%;
      height:100%;
      overflow:hidden;
    }
    canvas{display:block; width:100%; height:100%;}
    .hud{
      position:absolute;
      inset:auto 12px 12px 12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      pointer-events:none;
      color:rgba(231,238,247,.85);
      font-size:12px;
    }
    .hud .left, .hud .right{
      display:flex; gap:10px; align-items:center;
      padding:8px 10px;
      border-radius:14px;
      background:rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.07);
      box-shadow: 0 0 0 1px rgba(255,255,255,.03) inset;
      backdrop-filter: blur(8px);
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.25);
      color:rgba(231,238,247,.9);
    }

    /* Bottom */
    .bottom{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding:12px 14px;
      border:1px solid var(--edge);
      border-radius:var(--r);
      background:var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      color:var(--muted);
      font-size:12px;
      flex-wrap:wrap;
    }

    /* Responsive */
@media (max-width: 980px){
  /* Mobile scrolling should be on the page */
  body { overflow:auto; }
  .wrap { height:auto; padding: 14px; }

  /* Make the left panel scrollable if it gets tall */
  .panel.left { overflow: auto; -webkit-overflow-scrolling: touch; }

  /* Cap the cover so controls are always visible */
  .cover{
    aspect-ratio: auto;
    height: 220px;          /* try 200–260 depending on taste */
    max-height: 35vh;       /* prevents giant cover on tall phones */
  }

  /* Give the player breathing room */
  .player{ padding-bottom: calc(14px + env(safe-area-inset-bottom)); }

  /* If controls wrap weirdly, keep them readable */
  .controlsRow { align-items: stretch; }
  .time { min-width: 72px; }
}
      .left{ grid-template-rows:auto auto auto; }
      .cover{ aspect-ratio: 16/12; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="top">
      <div class="title">
        <h1>EchoVerse Player</h1>
        <p>
          “Sacred Certainty” — industrial swamp sermon.<br/>
          Belief becomes a throne; people become furniture.
        </p>
      </div>
      <div class="meta">
        <div class="pill"><i></i> VISUALIZER / FFT</div><br/>
        <span id="status">Ready</span>
      </div>
    </header>

    <main class="main">
      <!-- LEFT -->
      <section class="panel left">
        <div class="cover">
          <!-- Change cover.png to your filename or URL -->
          <img id="coverImg" src="cover.png" alt="Sacred Certainty cover art" />
          <div class="coverLabel">
            <div class="track">
              <strong>Sacred Certainty</strong>
              <span>Dark Swamp-Hop · Industrial Sermon</span>
            </div>
            <div class="badge"><b></b> EchoVerse</div>
          </div>
        </div>

        <div class="player">
          <!-- Hidden native audio (we control it) -->
          <!-- Change Sacred Certainty.mp3 to your filename or URL -->
          <audio id="audio" preload="metadata" crossorigin="anonymous" src="Sacred Certainty.mp3"></audio>

          <div class="controlsRow">
            <button id="playBtn" class="btn btnPrimary btnIcon" aria-label="Play/Pause">▶</button>

            <div class="bar">
              <input id="seek" class="seek" type="range" min="0" max="1000" value="0" step="1" aria-label="Seek"/>
              <div class="subRow">
                <div class="leftMeta">
                  <span class="chip"><small>Mode</small> <b id="modeLbl">Bars</b></span>
                  <span class="chip"><small>Intensity</small> <b id="intLbl">Medium</b></span>
                </div>
                <div class="rightMeta">
                  <span id="curTime" class="time">0:00</span>
                  <span style="opacity:.6">/</span>
                  <span id="durTime" class="time">0:00</span>
                </div>
              </div>
            </div>
          </div>

          <div class="sliders">
            <div class="sliderGroup">
              <label for="vol">Vol</label>
              <input id="vol" type="range" min="0" max="1" step="0.01" value="0.90" aria-label="Volume"/>
              <div id="volVal" class="val">90%</div>
            </div>
            <div class="sliderGroup">
              <label for="spd">Speed</label>
              <input id="spd" type="range" min="0.75" max="1.25" step="0.01" value="1.00" aria-label="Speed"/>
              <div id="spdVal" class="val">1.00×</div>
            </div>
          </div>

          <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
            <button id="modeBtn" class="btn">Mode (M)</button>
            <button id="intBtn" class="btn">Intensity (I)</button>
            <button id="back10" class="btn">⟲ 10s</button>
            <button id="fwd10" class="btn">10s ⟳</button>
          </div>
        </div>

        <div class="lyrics">
          <div class="lyricsTop">
            <h2>Lyrics</h2>
            <div id="lyricsToggle" class="toggle">Hide</div>
          </div>
          <div id="lyricsBox" class="lyricsBox">
            <div class="sec">
              <div class="secHeader"><b>Intro</b><span>spoken</span></div>
              <p>If you wanna keep evil alive…
Don’t teach people hate.
Teach them <em>certainty</em>.</p>
            </div>

            <div class="sec">
              <div class="secHeader"><b>Verse 1</b><span>halftime crawl</span></div>
              <p>Want a world that never heals? Here’s the recipe—
Pick a truth, make it sacred, lock it in, never leave.
Could be scripture, could be papers with a flag in the breeze,
Could be “logic,” could be “progress,” could be “freedom” on sleeves.
Doesn’t matter what you choose, just make it your whole face,
Let it swallow up your name, let it seal up your grace.
Start sorting human lives like a ledger in a bank—
Who’s a “real one,” who’s a “traitor,” who deserves what they get…
And the best part? You’ll feel holy when you’re cruel,
’Cause your beliefs are more important than the Golden Rule.</p>
            </div>

            <div class="sec">
              <div class="secHeader"><b>Chorus</b><span>sermon cadence</span></div>
              <p>Keep your belief over blood, keep your flag over love,
Keep your doctrine as a gun, keep your prayers full of mud.
If your truth comes first—then a body don’t mean much,
And you’ll kill with a smile when you feelin’ righteous enough.</p>
            </div>

            <div class="sec">
              <div class="secHeader"><b>Verse 2</b><span>heavier metal ticks</span></div>
              <p>See ideology’s clean—cuts the world into two,
Tells you who to forgive and who’s beneath you.
Turns doubt into weakness, turns nuance into sin,
If they disagree with your book, you can’t let ’em win…
And the devil don’t show up with horns in the street—
He shows up as <em>certainty</em> with a beat.</p>
            </div>

            <div class="sec">
              <div class="secHeader"><b>Bridge</b><span>spoken sermon</span></div>
              <p>Belief ain’t the sickness.
Belief is a tool.
The sickness is when belief becomes a throne…
…and everybody else becomes furniture.</p>
            </div>

            <div class="sec" style="margin-bottom:0;">
              <div class="secHeader"><b>Final Chorus</b><span>biggest drop</span></div>
              <p>Keep your belief over blood, keep your flag over love,
Keep your doctrine as a gun, keep your prayers full of mud.
If your truth comes first—then a body don’t mean much,
And you’ll kill with a smile when you feelin’ righteous enough.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT -->
      <section class="panel right">
        <div class="canvasCard">
          <canvas id="viz"></canvas>
          <div class="hud">
            <div class="left">
              <span>Keys:</span>
              <span class="kbd">M</span> mode
              <span class="kbd">I</span> intensity
              <span class="kbd">Space</span> play
            </div>
            <div class="right">
              <span>EchoVerse</span> · <span id="vizState">idle</span>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="bottom">
      <span>Single-file EchoVerse drop · Cover + Custom Player + Visualizer + Lyrics</span>
      <span>Tip: If a browser blocks analysis locally, host via a tiny web server.</span>
    </footer>
  </div>

<script>
(() => {
  // Elements
  const canvas = document.getElementById('viz');
  const ctx = canvas.getContext('2d');
  const audio = document.getElementById('audio');

  const statusEl = document.getElementById('status');
  const vizState = document.getElementById('vizState');

  const playBtn = document.getElementById('playBtn');
  const seek = document.getElementById('seek');
  const curTime = document.getElementById('curTime');
  const durTime = document.getElementById('durTime');

  const vol = document.getElementById('vol');
  const volVal = document.getElementById('volVal');
  const spd = document.getElementById('spd');
  const spdVal = document.getElementById('spdVal');

  const modeBtn = document.getElementById('modeBtn');
  const intBtn = document.getElementById('intBtn');
  const back10 = document.getElementById('back10');
  const fwd10 = document.getElementById('fwd10');

  const modeLbl = document.getElementById('modeLbl');
  const intLbl = document.getElementById('intLbl');

  const lyricsToggle = document.getElementById('lyricsToggle');
  const lyricsBox = document.getElementById('lyricsBox');

  // Resize canvas
  function resize() {
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * dpr);
    canvas.height = Math.floor(rect.height * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  window.addEventListener('resize', resize);
  resize();

  // Formatting
  function fmtTime(s){
    if (!isFinite(s) || s < 0) return "0:00";
    const m = Math.floor(s/60);
    const r = Math.floor(s%60);
    return m + ":" + String(r).padStart(2,"0");
  }

  // Audio control state
  let isSeeking = false;

  // WebAudio (visualizer)
  let ac, src, analyser, data, timeData, armed = false;

  const modes = ['Bars', 'Wave', 'Pulse'];
  let modeIdx = 0;

  const intensities = [
    { name:'Low', fft:1024, smooth:.92, gain:0.70 },
    { name:'Medium', fft:2048, smooth:.86, gain:1.00 },
    { name:'High', fft:4096, smooth:.78, gain:1.35 },
  ];
  let intIdx = 1;

  function setMode(idx){
    modeIdx = (idx + modes.length) % modes.length;
    modeLbl.textContent = modes[modeIdx];
  }
  function setIntensity(idx){
    intIdx = (idx + intensities.length) % intensities.length;
    intLbl.textContent = intensities[intIdx].name;
    if (analyser){
      const cfg = intensities[intIdx];
      analyser.fftSize = cfg.fft;
      analyser.smoothingTimeConstant = cfg.smooth;
      data = new Uint8Array(analyser.frequencyBinCount);
      timeData = new Uint8Array(analyser.fftSize);
    }
  }

  function arm(){
    if (armed) return;
    ac = new (window.AudioContext || window.webkitAudioContext)();
    src = ac.createMediaElementSource(audio);
    analyser = ac.createAnalyser();

    const cfg = intensities[intIdx];
    analyser.fftSize = cfg.fft;
    analyser.smoothingTimeConstant = cfg.smooth;

    data = new Uint8Array(analyser.frequencyBinCount);
    timeData = new Uint8Array(analyser.fftSize);

    src.connect(analyser);
    analyser.connect(ac.destination);

    armed = true;
    statusEl.textContent = 'Armed — analyzing audio';
    vizState.textContent = 'armed';
  }

  async function ensureAudioContext(){
    arm();
    if (ac && ac.state === 'suspended') await ac.resume();
  }

  // Custom player actions
  async function togglePlay(){
    await ensureAudioContext();
    if (audio.paused) await audio.play();
    else audio.pause();
  }

  function jump(sec){
    audio.currentTime = Math.max(0, Math.min(audio.duration || 0, audio.currentTime + sec));
  }

  // Hook up UI
  playBtn.addEventListener('click', togglePlay);

  back10.addEventListener('click', () => jump(-10));
  fwd10.addEventListener('click', () => jump(10));

  modeBtn.addEventListener('click', () => setMode(modeIdx + 1));
  intBtn.addEventListener('click', () => setIntensity(intIdx + 1));

  vol.addEventListener('input', () => {
    audio.volume = Number(vol.value);
    volVal.textContent = Math.round(audio.volume * 100) + "%";
  });

  spd.addEventListener('input', () => {
    audio.playbackRate = Number(spd.value);
    spdVal.textContent = audio.playbackRate.toFixed(2) + "×";
  });

  seek.addEventListener('input', () => {
    isSeeking = true;
    if (!audio.duration) return;
    const t = (Number(seek.value) / 1000) * audio.duration;
    curTime.textContent = fmtTime(t);
  });

  seek.addEventListener('change', async () => {
    await ensureAudioContext();
    if (!audio.duration) return;
    const t = (Number(seek.value) / 1000) * audio.duration;
    audio.currentTime = t;
    isSeeking = false;
  });

  audio.addEventListener('play', () => {
    playBtn.textContent = "❚❚";
    statusEl.textContent = "Playing";
    vizState.textContent = "live";
  });

  audio.addEventListener('pause', () => {
    playBtn.textContent = "▶";
    statusEl.textContent = "Paused";
    vizState.textContent = armed ? "armed" : "idle";
  });

  audio.addEventListener('loadedmetadata', () => {
    durTime.textContent = fmtTime(audio.duration);
    curTime.textContent = fmtTime(audio.currentTime);
  });

  audio.addEventListener('timeupdate', () => {
    if (!audio.duration) return;
    if (!isSeeking){
      const v = (audio.currentTime / audio.duration) * 1000;
      seek.value = String(Math.max(0, Math.min(1000, Math.round(v))));
      curTime.textContent = fmtTime(audio.currentTime);
    }
  });

  // Lyrics toggle
  let lyricsOpen = true;
  lyricsToggle.addEventListener('click', () => {
    lyricsOpen = !lyricsOpen;
    lyricsBox.style.display = lyricsOpen ? "block" : "none";
    lyricsToggle.textContent = lyricsOpen ? "Hide" : "Show";
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', async (e) => {
    const k = e.key.toLowerCase();
    if (k === 'm') setMode(modeIdx + 1);
    if (k === 'i') setIntensity(intIdx + 1);
    if (e.code === 'Space') {
      e.preventDefault();
      await togglePlay();
    }
    if (e.key === 'ArrowLeft') jump(-5);
    if (e.key === 'ArrowRight') jump(5);
  });

  // Visualizer rendering
  function drawBackground(w, h, energy) {
    const g = ctx.createLinearGradient(0, 0, 0, h);
    g.addColorStop(0, `rgba(10,12,16,1)`);
    g.addColorStop(1, `rgba(6,8,12,1)`);
    ctx.fillStyle = g;
    ctx.fillRect(0, 0, w, h);

    // Fog lines
    const bands = 7;
    for (let i=0;i<bands;i++){
      const y = (h*(i+1))/(bands+1);
      const a = 0.03 + energy*0.07;
      ctx.fillStyle = `rgba(255,255,255,${a})`;
      ctx.fillRect(0, y + Math.sin((Date.now()/900)+(i*1.2))*8, w, 1);
    }

    // Vignette
    ctx.fillStyle = 'rgba(0,0,0,.35)';
    ctx.fillRect(0, 0, w, h);
  }

  function computeEnergy(){
    if (!analyser) return 0;
    analyser.getByteFrequencyData(data);
    let sum = 0;
    const n = data.length;
    const maxBin = Math.min(n, 220);
    for (let i=0;i<maxBin;i++){
      const v = data[i] / 255;
      sum += v*v;
    }
    return Math.min(1, Math.sqrt(sum / maxBin));
  }

  function render(){
    const w = canvas.clientWidth;
    const h = canvas.clientHeight;

    const energy = armed ? computeEnergy() : 0;
    drawBackground(w, h, energy);

    if (!analyser){
      ctx.fillStyle = 'rgba(231,238,247,.75)';
      ctx.font = '600 14px ui-sans-serif, system-ui';
      ctx.fillText('Press play to awaken the sermon.', 18, 30);
      requestAnimationFrame(render);
      return;
    }

    const cfg = intensities[intIdx];
    const gain = cfg.gain;

    if (modes[modeIdx] === 'Bars') {
      analyser.getByteFrequencyData(data);
      const bars = Math.min(140, data.length);
      const barW = (w - 36) / bars;
      const x0 = 18;
      const y0 = h - 22;

      for (let i=0;i<bars;i++){
        const v = (data[i] / 255) * gain;
        const bh = Math.max(2, v * (h * 0.72));
        const x = x0 + i * barW;
        const y = y0 - bh;

        ctx.fillStyle = `rgba(255,255,255,${0.05 + v*0.20})`;
        ctx.fillRect(x, y, Math.max(1, barW*0.72), bh);

        if (v > 0.55) {
          ctx.fillStyle = `rgba(255,160,64,${(v-0.55)*0.95})`;
          ctx.fillRect(x, y, Math.max(1, barW*0.72), 2);
        }
      }
    }

    if (modes[modeIdx] === 'Wave') {
      analyser.getByteTimeDomainData(timeData);
      ctx.lineWidth = 2;
      ctx.strokeStyle = `rgba(231,238,247,${0.22 + energy*0.55})`;
      ctx.beginPath();
      const x0 = 18;
      const x1 = w - 18;
      const mid = h * 0.52;
      const amp = (h * 0.22) * (0.35 + energy) * gain;

      for (let i=0;i<timeData.length;i++){
        const t = i / (timeData.length - 1);
        const x = x0 + t * (x1 - x0);
        const v = (timeData[i] - 128) / 128;
        const y = mid + v * amp;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();

      ctx.lineWidth = 1;
      ctx.strokeStyle = `rgba(255,160,64,${energy*0.22})`;
      ctx.stroke();
    }

    if (modes[modeIdx] === 'Pulse') {
      analyser.getByteFrequencyData(data);
      const pulse = Math.min(1, energy * 1.2) * gain;
      const cx = w * 0.5;
      const cy = h * 0.5;
      const r0 = 26;
      const rings = 6;

      for (let i=0;i<rings;i++){
        const t = (i + 1) / rings;
        const r = r0 + t * (Math.min(w,h) * 0.34) * (0.35 + pulse);
        ctx.beginPath();
        ctx.arc(cx, cy, r, 0, Math.PI*2);
        ctx.lineWidth = 1.5;
        ctx.strokeStyle = `rgba(255,255,255,${0.04 + pulse*0.18})`;
        ctx.stroke();
      }

      ctx.beginPath();
      ctx.arc(cx, cy, r0 + pulse*22, 0, Math.PI*2);
      ctx.lineWidth = 2;
      ctx.strokeStyle = `rgba(255,160,64,${0.18 + pulse*0.60})`;
      ctx.stroke();
    }

    requestAnimationFrame(render);
  }
  render();

  // Initialize labels + sliders
  setMode(modeIdx);
  setIntensity(intIdx);

  audio.volume = Number(vol.value);
  volVal.textContent = Math.round(audio.volume * 100) + "%";
  audio.playbackRate = Number(spd.value);
  spdVal.textContent = audio.playbackRate.toFixed(2) + "×";

  // If user clicks anywhere in player panel, arm audio context (helps mobile)
  document.querySelector('.player').addEventListener('pointerdown', () => {
    // don’t auto-play, just arm
    if (!armed) arm();
  });

})();
</script>
</body>
</html>      // idle text
      ctx.fillStyle = 'rgba(231,238,247,.75)';
      ctx.font = '600 14px ui-sans-serif, system-ui';
      ctx.fillText('Press play to awaken the sermon.', 18, 30);
      requestAnimationFrame(render);
      return;
    }

    const cfg = intensities[intIdx];
    const gain = cfg.gain;

    if (modes[modeIdx] === 'Bars') {
      analyser.getByteFrequencyData(data);<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EchoVerse Visualizer — Sacred Certainty</title>
  <style>
    :root{
      --bg0:#07090c;
      --bg1:#0b1016;
      --fg:#e7eef7;
      --muted:#9aa7b6;
      --edge:rgba(255,255,255,.10);
      --edge2:rgba(255,255,255,.06);
      --glow:rgba(255,255,255,.12);
      --warn:rgba(255,160,64,.85);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      color:var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.06), transparent 55%),
        radial-gradient(900px 500px at 85% 30%, rgba(255,160,64,.07), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }
    .wrap{
      position:relative;
      display:grid;
      grid-template-rows:auto 1fr auto;
      height:100vh;
      padding:18px;
      gap:12px;
    }
    .top{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      padding:14px 14px 10px;
      border:1px solid var(--edge);
      border-radius:16px;
      background:rgba(255,255,255,.03);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
    }
    .title h1{
      margin:0;
      font-size:18px;
      letter-spacing:.14em;
      text-transform:uppercase;
    }
    .title p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
      max-width:56ch;
    }
    .meta{
      text-align:right;
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
      white-space:nowrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--edge2);
      border-radius:999px;
      background:rgba(0,0,0,.18);
      color:var(--fg);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .pill i{
      width:8px;height:8px;border-radius:50%;
      background:var(--warn);
      box-shadow: 0 0 16px var(--warn);
      display:inline-block;
    }
    .canvasCard{
      position:relative;
      border:1px solid var(--edge);
      border-radius:18px;
      background:rgba(255,255,255,.02);
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      overflow:hidden;
    }
    canvas{display:block; width:100%; height:100%;}
    .hud{
      position:absolute;
      inset:auto 12px 12px 12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      pointer-events:none;
      color:rgba(231,238,247,.85);
      font-size:12px;
    }
    .hud .left, .hud .right{
      display:flex; gap:10px; align-items:center;
      padding:8px 10px;
      border-radius:14px;
      background:rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.07);
      box-shadow: 0 0 0 1px rgba(255,255,255,.03) inset;
      backdrop-filter: blur(8px);
    }
    .bottom{
      border:1px solid var(--edge);
      border-radius:16px;
      padding:12px 12px 10px;
      background:rgba(255,255,255,.03);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
    }
    audio{ width:100%; }
    .note{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.25);
      color:rgba(231,238,247,.9);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="top">
      <div class="title">
        <h1>EchoVerse Visualizer</h1>
        <p>
          “Sacred Certainty” — industrial swamp sermon.<br/>
          Belief becomes a throne; people become furniture.
        </p>
      </div>
      <div class="meta">
        <div class="pill"><i></i> LIVE FFT / WAVE</div><br/>
        <span id="status">Click play to arm audio</span>
      </div>
    </header>

    <section class="canvasCard">
      <canvas id="viz"></canvas>
      <div class="hud">
        <div class="left">
          <span>Mode:</span> <strong id="mode">Bars</strong>
          <span>·</span>
          <span>Intensity:</span> <strong id="intensity">Medium</strong>
        </div>
        <div class="right">
          <span>Keys:</span>
          <span class="kbd">M</span> mode
          <span class="kbd">I</span> intensity
        </div>
      </div>
    </section>

    <footer class="bottom">
      <!-- Replace src with your hosted URL or local relative path -->
      <audio id="audio" controls preload="metadata" crossorigin="anonymous"
             src="Sacred Certainty.mp3"></audio>
      <div class="note">
        <span>Tip: If opening locally, some browsers require a local server for audio + analysis.</span>
        <span>Designed for EchoVerse drops — single-file, portable.</span>
      </div>
    </footer>
  </div>

<script>
(() => {
  const canvas = document.getElementById('viz');
  const ctx = canvas.getContext('2d');
  const audio = document.getElementById('audio');
  const statusEl = document.getElementById('status');
  const modeEl = document.getElementById('mode');
  const intensityEl = document.getElementById('intensity');

  let ac, src, analyser, data, timeData;
  let armed = false;

  const modes = ['Bars', 'Wave', 'Pulse'];
  let modeIdx = 0;

  const intensities = [
    { name:'Low', fft:1024, smooth:.92, gain:0.7 },
    { name:'Medium', fft:2048, smooth:.86, gain:1.0 },
    { name:'High', fft:4096, smooth:.78, gain:1.35 },
  ];
  let intIdx = 1;

  function resize() {
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * dpr);
    canvas.height = Math.floor(rect.height * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  window.addEventListener('resize', resize);
  resize();

  function arm() {
    if (armed) return;
    ac = new (window.AudioContext || window.webkitAudioContext)();
    src = ac.createMediaElementSource(audio);
    analyser = ac.createAnalyser();

    const cfg = intensities[intIdx];
    analyser.fftSize = cfg.fft;
    analyser.smoothingTimeConstant = cfg.smooth;

    data = new Uint8Array(analyser.frequencyBinCount);
    timeData = new Uint8Array(analyser.fftSize);

    src.connect(analyser);
    analyser.connect(ac.destination);

    armed = true;
    statusEl.textContent = 'Armed — analyzing audio';
  }

  function setIntensity(idx) {
    intIdx = (idx + intensities.length) % intensities.length;
    intensityEl.textContent = intensities[intIdx].name;
    if (analyser) {
      const cfg = intensities[intIdx];
      analyser.fftSize = cfg.fft;
      analyser.smoothingTimeConstant = cfg.smooth;
      data = new Uint8Array(analyser.frequencyBinCount);
      timeData = new Uint8Array(analyser.fftSize);
    }
  }

  function setMode(idx) {
    modeIdx = (idx + modes.length) % modes.length;
    modeEl.textContent = modes[modeIdx];
  }

  // Arm on first user gesture related to audio
  audio.addEventListener('play', async () => {
    arm();
    if (ac && ac.state === 'suspended') await ac.resume();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 'm') setMode(modeIdx + 1);
    if (e.key.toLowerCase() === 'i') setIntensity(intIdx + 1);
  });

  function drawBackground(w, h, energy) {
    // Moody gradient + faint fog bands
    const g = ctx.createLinearGradient(0, 0, 0, h);
    g.addColorStop(0, `rgba(10,12,16,1)`);
    g.addColorStop(1, `rgba(6,8,12,1)`);
    ctx.fillStyle = g;
    ctx.fillRect(0, 0, w, h);

    // Fog lines
    const bands = 7;
    for (let i=0;i<bands;i++){
      const y = (h*(i+1))/(bands+1);
      const a = 0.035 + energy*0.06;
      ctx.fillStyle = `rgba(255,255,255,${a})`;
      ctx.fillRect(0, y + Math.sin((Date.now()/900)+(i*1.2))*8, w, 1);
    }

    // Vignette
    ctx.fillStyle = 'rgba(0,0,0,.35)';
    ctx.fillRect(0, 0, w, h);
  }

  function computeEnergy() {
    if (!analyser) return 0;
    analyser.getByteFrequencyData(data);
    let sum = 0;
    const n = data.length;
    // emphasize lows + low-mids for “swamp crawl”
    const maxBin = Math.min(n, 220);
    for (let i=0;i<maxBin;i++){
      const v = data[i] / 255;
      sum += v*v;
    }
    return Math.min(1, Math.sqrt(sum / maxBin));
  }

  function render() {
    const w = canvas.clientWidth;
    const h = canvas.clientHeight;

    const energy = armed ? computeEnergy() : 0;
    drawBackground(w, h, energy);

    if (!analyser) {
      // idle text
      ctx.fillStyle = 'rgba(231,238,247,.75)';
      ctx.font = '600 14px ui-sans-serif, system-ui';
      ctx.fillText('Press play to awaken the sermon.', 18, 30);
      requestAnimationFrame(render);
      return;
    }

    const cfg = intensities[intIdx];
    const gain = cfg.gain;

    if (modes[modeIdx] === 'Bars') {
      analyser.getByteFrequencyData(data);
